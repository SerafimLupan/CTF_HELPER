#!/bin/bash
# HackTricks Ref: http-parameter-pollution.md
# Module: HTTP Parameter Pollution (HPP)

echo -e "${C6}[WEB ATTACK: LOGIC_PARAMETER_POLLUTION]${NC}"
echo -e "Reference: https://book.hacktricks.xyz/pentesting-web/http-parameter-pollution"
echo -e "--------------------------------------------------"

echo -e "${C4}Select HPP Testing Vector:${NC}"
echo "1) WAF Bypass (Splitting Payloads)"
echo "2) Logic Manipulation (Social Sharing/Actions)"
echo "3) Server Behavior Fingerprinting"
echo "4) URL Override (Internal Redirects)"
echo "0) Exit"

read -p "Selection: " hpp_opt

case $hpp_opt in
    1)
        echo -e "\n${C2}[*] WAF Bypass via Parameter Splitting:${NC}"
        echo "If a WAF blocks 'SELECT FROM', try splitting it across parameters:"
        echo " - Query: ?id=SELECT&id=FROM"
        echo "Some backends (like ASP.NET) concatenate these into 'SELECT,FROM' or 'SELECT FROM'."
        ;;
    2)
        echo -e "\n${C2}[*] Logic Manipulation:${NC}"
        echo "Targeting internal actions like transfers or deletions:"
        echo " - Original: /transfer?amount=100&to=bob"
        echo " - Payload:  /transfer?amount=100&to=bob&amount=0.01"
        echo "If the backend takes the LAST occurrence, you might transfer a different amount than intended."
        ;;
    3)
        echo -e "\n${C2}[*] Server Behavior Identification:${NC}"
        echo "Test how the technology stack handles '?id=1&id=2':"
        echo " - ASP.NET / IIS: Concatenates with comma (1,2)"
        echo " - PHP / Apache:  Takes the LAST one (2)"
        echo " - JSP / Tomcat:  Takes the FIRST one (1)"
        echo " - Node.js:       Creates an array [1, 2]"
        ;;
    4)
        echo -e "\n${C2}[*] URL Override / Unintended Actions:${NC}"
        echo "Exploit links generated by the server:"
        echo " - Link: https://site.com/share?url=https://mysite.com"
        echo " - Payload: https://site.com/share?url=https://mysite.com&via=@attacker"
        echo "This can inject extra parameters into the final generated link/action."
        ;;
    *) return ;;
esac

echo -e "\n--------------------------------------------------"
read -p "Press Enter to return..."

