#!/bin/bash
# Module: Web Pentesting (HackTricks Methodology)
# This module is called by the main ctf_helper.sh script

function run_web_pentest() {
    print_banner # Call banner from main script for consistency
    echo -e "${C6}[WEB PENTESTING MODULE]${NC}"
    echo -e "Based on: https://book.hacktricks.xyz/pentesting-web/pentesting-web-methodology"
    echo -e "----------------------------------------------------------------------------"
    echo -e "1) ðŸ”  Fuzzing (Directories/Files) - gobuster/ffuf"
    echo -e "2) ðŸ›°ï¸   Subdomain Enumeration"
    echo -e "3) ðŸ•µï¸   HTTP Headers Analysis (Security Check)"
    echo -e "4) ðŸ“¦  CMS Detection (WordPress/Joomla/Drupal)"
    echo -e "5) ðŸ“‚  Common Files Scan (robots.txt, sitemap.xml, .git, .env)"
    echo -e "0) â†©ï¸   Return to Main Menu"
    
    echo -ne "\n${C5}Web Selection: ${NC}"
    read wopt

    case $wopt in
        1)
            read -p "Enter Target URL: " target
            echo -e "[*] Running Gobuster..."
            gobuster dir -u "$target" -w /usr/share/wordlists/dirb/common.txt -t 50
            ;;
        2)
            read -p "Enter Domain: " domain
            echo -e "[*] Fuzzing Subdomains..."
            ffuf -u "http://FUZZ.$domain" -w /usr/share/wordlists/dirb/common.txt
            ;;
        3)
            read -p "Enter URL: " target
            echo -e "[*] Analyzing Security Headers..."
            curl -I -s "$target" | grep -iE "Content-Security-Policy|X-Frame-Options|X-Content-Type-Options|Strict-Transport-Security"
            ;;
        4)
            read -p "Enter URL: " target
            echo -e "[*] Detecting CMS..."
            whatweb "$target" 2>/dev/null || echo "Please install whatweb or use browser extensions."
            ;;
        5)
            read -p "Enter Base URL (e.g. http://site.com): " target
            echo -e "[*] Checking sensitive files..."
            for file in "robots.txt" "sitemap.xml" ".git/config" ".env" ".htaccess"; do
                echo -ne "[?] Checking $target/$file ... "
                status=$(curl -o /dev/null -s -w "%{http_code}" "$target/$file")
                if [ "$status" == "200" ]; then echo -e "${C6}FOUND (200)${NC}"; else echo -e "Not found ($status)"; fi
            done
            ;;
        0) return ;;
        *) echo -e "${C1}Invalid selection.${NC}" ; sleep 1 ;;
    esac
    read -p "Press Enter to return..."
}
