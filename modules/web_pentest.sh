#!/bin/bash
# Module: Web Pentesting (HackTricks Methodology)
# This module is called by the main ctf_helper.sh script
# CTF_HELPER - Web Pentest Router (HackTricks Methodology)

function run_web_pentest() {
    while true; do
        print_banner
        echo -e "${C6}[WEB VULNERABILITIES MENU]${NC}"
        echo -e "Based on: https://book.hacktricks.xyz/pentesting-web/pentesting-web-methodology"
        echo -e "----------------------------------------------------------------------------"
        echo -e "1)  üõ°Ô∏è  Auth & Account (2FA, ATO, JWT, OAuth, SAML, Login, Signup)"
        echo -e "2)  üíâ  Injection Deep-Dive (SQLi, NoSQL, Command, LDAP, XPath, XSLT, ORM)"
        echo -e "3)  üåç  Server-Side Magic (SSRF, XXE, SSTI, Smuggling, LFI/RFI, Upload)"
        echo -e "4)  üñ•Ô∏è  Client-Side & Browser (XSS, CSRF, CORS, CSP, PostMessage, Iframes)"
        echo -e "5)  üí∏  Business Logic & Headers (Payment, IDOR, Race Condition, Cache, Smuggling)"
        echo -e "6)  üî¨  Modern Tech & Misc (DApps, gRPC, WebSockets, UUID, Unicode, ReDoS)"
        echo -e "7)  üìú  Methodologies & PoC CheatSheets"
        echo -e "0)  ‚Ü©Ô∏è   Return to Main Menu"

        echo -ne "\n${C5}Select Category: ${NC}"
        read wcat

        case $wcat in
            1) list_web_scripts "auth" ;;
            2) list_web_scripts "injection" ;;
            3) list_web_scripts "server" ;;
            4) list_web_scripts "client" ;;
            5) list_web_scripts "logic" ;;
            6) list_web_scripts "modern" ;;
            7) list_web_scripts "methodology" ;;
            0) break ;;
            *) echo -e "${C1}Invalid selection.${NC}" ; sleep 1 ;;
        esac
    done
}

function list_web_scripts() {
    local category=$1
    echo -e "\n${C4}--- Available Scripts for $category ---${NC}"
    # ListƒÉm scripturile din folderul modules/web care √Æncep cu categoria respectivƒÉ
    ls modules/web/${category}_*.sh | xargs -n 1 basename | sed 's/\.sh//'
    
    echo -ne "\n${C5}Enter script name to run (or 'q' to go back): ${NC}"
    read sname
    if [[ "$sname" != "q" ]]; then
        if [ -f "modules/web/${sname}.sh" ]; then
            bash "modules/web/${sname}.sh"
        else
            echo -e "${C1}[!] Script not found.${NC}"
            sleep 1
        fi
    fi
}
