#!/bin/bash
# Module: Web Pentesting Framework (HackTricks Based)
# Descriere: GestioneazÄƒ fluxul de lucru pentru toate cele 50+ scripturi de web.

function run_web_pentest() {
    while true; do
        print_banner
        echo -e "${C6}[WEB VULNERABILITIES MENU]${NC}"
        echo -e "Based on: https://book.hacktricks.xyz/pentesting-web/pentesting-web-methodology"
        echo -e "----------------------------------------------------------------------------"
        echo -e "1)  ðŸ›¡ï¸  Auth & Account (2FA, ATO, JWT, OAuth, Login, Captcha)"
        echo -e "2)  ðŸ’‰  Injection (SQLi, NoSQL, Command, LDAP, XPath, XSLT, ORM)"
        echo -e "3)  ðŸŒ  Server-Side (SSRF, XXE, SSTI, Smuggling, LFI/RFI, Upload)"
        echo -e "4)  ðŸ–¥ï¸  Client-Side (XSS, CSRF, CORS, CSP, PostMessage, Iframes)"
        echo -e "5)  ðŸ’¸  Logic & Headers (Payment, IDOR, Race Condition, Cache, Mass Assign)"
        echo -e "6)  ðŸ”¬  Modern Tech (DApps, gRPC, WebSockets, UUID, ReDoS)"
        echo -e "7)  ðŸ“œ  Methodology & PoC CheatSheets"
        echo -e "0)  â†©ï¸   Return to Main Menu"

        echo -ne "\n${C5}Select Category: ${NC}"
        read wcat

        case $wcat in
            1) list_web_scripts "auth" ;;
            2) list_web_scripts "injection" ;;
            3) list_web_scripts "server" ;;
            4) list_web_scripts "client" ;;
            5) list_web_scripts "logic" ;;
            6) list_web_scripts "modern" ;;
            7) list_web_scripts "methodology" ;;
            0) break ;;
            *) echo -e "${C1}Invalid selection.${NC}" ; sleep 1 ;;
        esac
    done
}

function list_web_scripts() {
    local category=$1
    echo -e "\n${C4}--- Available Scripts for $category ---${NC}"
    
    # CÄƒutÄƒm scripturile care Ã®ncep cu prefixul categoriei
    local scripts=( $(ls modules/web/${category}_*.sh 2>/dev/null) )
    
    if [ ${#scripts[@]} -eq 0 ]; then
        echo -e "${C1}[!] No scripts found for this category.${NC}"
        sleep 1
        return
    fi

    # AfiÈ™Äƒm frumos lista pentru utilizator
    local i=1
    for s in "${scripts[@]}"; do
        echo -e "$i) $(basename "$s" .sh)"
        ((i++))
    done

    echo -ne "\n${C5}Select script number to run (or 'q' to go back): ${NC}"
    read s_idx

    if [[ "$s_idx" =~ ^[0-9]+$ ]] && [ "$s_idx" -le "${#scripts[@]}" ] && [ "$s_idx" -gt 0 ]; then
        local target_script="${scripts[$((s_idx-1))]}"
        bash "$target_script"
    elif [[ "$s_idx" == "q" ]]; then
        return
    else
        echo -e "${C1}[!] Invalid selection.${NC}"
        sleep 1
    fi
}
